<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>초간단 비건 디저트 가이드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
  <style>
    body {
      font-family: "Pretendard", sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f6f4f1;
      color: #333;
    }
    .season-button.active { font-weight: bold; color: green; }
    .recipe-thumbnails, .recipe-detail { display: none; }
    .comment-rating { color: #f5b301; margin-right: 0.5rem; }
    .comment-item { margin: 0.5rem 0; display: flex; align-items: center; }
  </style>
</head>
<body>
  <h1>초간단 비건 디저트 가이드</h1>
  <div class="season-buttons">
    <button class="season-button" onclick="showSeason('spring')">봄</button>
    <button class="season-button" onclick="showSeason('summer')">여름</button>
    <button class="season-button" onclick="showSeason('autumn')">가을</button>
    <button class="season-button" onclick="showSeason('winter')">겨울</button>
  </div>

  <div id="spring" class="recipe-thumbnails">
    <div class="thumbnail" onclick="showRecipe('matcha')">말차 라떼</div>
  </div>

  <div id="matcha" class="recipe-detail">
    <h2>말차 라떼</h2>
    <p>비건 말차 라떼 만드는 법.</p>
    <button onclick="backToThumbnails('spring')">목록으로</button>
  </div>

  <h3>발자국을 남겨주세요!</h3>
  <form id="commentForm" onsubmit="addComment(event)">
    <label><input type="radio" name="rating" value="1">★</label>
    <label><input type="radio" name="rating" value="2">★★</label>
    <label><input type="radio" name="rating" value="3">★★★</label>
    <label><input type="radio" name="rating" value="4">★★★★</label>
    <label><input type="radio" name="rating" value="5">★★★★★</label><br>
    <textarea id="commentInput" placeholder="내용 작성"></textarea><br>
    <button type="submit">전송</button>
  </form>
  <div id="commentsList"></div>

  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzBEFXoCmwB-TqUpZQ0Ar1Ezj8AsKgeClKKGVByhXcvbeQX1D2YFJbzJzFqGl5TTCWZKA/exec';

    function sendDataToSheet(eventData) {
      fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(eventData)
      })
      .then(() => console.log('Data sent successfully'))
      .catch(err => console.error('Error sending data:', err));
    }

    let currentSeason = '';
    let currentRecipe = '';

    function showSeason(season) {
      currentSeason = season;
      currentRecipe = '';

      document.querySelectorAll('.season-button').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.trim() === season);
      });

      document.querySelectorAll('.recipe-thumbnails, .recipe-detail').forEach(el => {
        el.style.display = 'none';
      });

      const seasonThumbs = document.getElementById(season);
      if (seasonThumbs) seasonThumbs.style.display = 'block';
    }

    function showRecipe(id) {
      currentRecipe = id;
      if (currentSeason) {
        const thumbs = document.getElementById(currentSeason);
        if (thumbs) thumbs.style.display = 'none';
      }

      document.querySelectorAll('.recipe-detail').forEach(el => el.style.display = 'none');
      const recipe = document.getElementById(id);
      if (recipe) {
        recipe.style.display = 'block';
        sendDataToSheet({ type: 'recipe_click', detail: id });
      }
    }

    function backToThumbnails(season) {
      currentRecipe = '';
      document.querySelectorAll('.recipe-detail').forEach(el => el.style.display = 'none');
      const thumbs = document.getElementById(season);
      if (thumbs) thumbs.style.display = 'block';
      showSeason(season);
    }

    function loadComments() {
      const comments = JSON.parse(localStorage.getItem('comments') || '[]');
      const commentsList = document.getElementById('commentsList');
      commentsList.innerHTML = '';
      comments.forEach(c => {
        const item = document.createElement('div');
        item.className = 'comment-item';
        item.innerHTML = `<span class="comment-rating">${'★'.repeat(c.rating)}${'☆'.repeat(5 - c.rating)}</span><span class="comment-text">${c.text}</span>`;
        commentsList.appendChild(item);
      });
    }

    function addComment(event) {
      event.preventDefault();
      const ratingInput = document.querySelector('input[name="rating"]:checked');
      const commentInput = document.getElementById('commentInput');
      const rating = ratingInput ? ratingInput.value : null;
      const commentText = commentInput.value.trim();

      if (!rating || !commentText) {
        alert('별점과 내용을 모두 입력해주세요.');
        return;
      }

      const comments = JSON.parse(localStorage.getItem('comments') || '[]');
      comments.push({ rating: parseInt(rating), text: commentText });
      localStorage.setItem('comments', JSON.stringify(comments));

      sendDataToSheet({ type: 'comment', detail: `rating: ${rating}, comment: ${commentText}` });

      document.getElementById('commentForm').reset();
      loadComments();
    }

    window.onload = () => {
      loadComments();
      showSeason('spring');
    };
  </script>
</body>
</html>
