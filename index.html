<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>초간단 비건 디저트 가이드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSS 순서 주의 -->
  <link href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; margin: 2rem; background:#f9f9f9; color:#333; }
    h1 { font-size:1.8rem; margin-bottom:1rem; }
    .season-button { margin-right:.5rem; padding:.3rem .8rem; border:1px solid #ccc; border-radius:4px; background:#fff; cursor:pointer; }
    .season-button.active { background:#dff5e1; color:#2c7a3f; font-weight:bold; }
    .recipe-thumbnails, .recipe-detail { display:none; margin-top:1rem; }
    .recipe-detail { padding:1rem; border:1px solid #ccc; background:#fff; }
    .thumbnail { padding:.5rem; border:1px solid #ccc; background:#fff; cursor:pointer; display:inline-block; margin-right:.5rem; }
    form { margin-top:2rem; padding:1rem; border:1px solid #ccc; background:#fff; }
    textarea { width:100%; height:4rem; margin-top:.5rem; }
    .comment-item { display:flex; align-items:center; margin:.5rem 0; }
    .comment-rating { color:#f5b301; margin-right:.5rem; }
  </style>
</head>
<body>

  <h1>초간단 비건 디저트 가이드</h1>
  <p>비건 디저트는 유제품과 달걀 없이도 가볍고...</p>

  <div class="season-buttons">
    <button class="season-button" onclick="showSeason('spring')">봄</button>
    <button class="season-button" onclick="showSeason('summer')">여름</button>
    <button class="season-button" onclick="showSeason('autumn')">가을</button>
    <button class="season-button" onclick="showSeason('winter')">겨울</button>
  </div>

  <div id="spring" class="recipe-thumbnails">
    <div class="thumbnail" onclick="showRecipe('matcha')">말차 라떼</div>
  </div>

  <div id="matcha" class="recipe-detail">
    <h2>말차 라떼</h2>
    <p>간단한 비건 말차 라떼 만드는 법...</p>
    <button onclick="backToThumbnails('spring')">목록으로</button>
  </div>

  <h3>발자국을 남겨주세요!</h3>
  <form id="commentForm" onsubmit="addComment(event)">
    <label><input type="radio" name="rating" value="5">★★★★★</label>
    <label><input type="radio" name="rating" value="4">★★★★</label>
    <label><input type="radio" name="rating" value="3">★★★</label><br>
    <textarea id="commentInput" placeholder="내용 작성"></textarea><br>
    <button type="submit">전송</button>
  </form>
  <div id="commentsList"></div>

  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/.../exec';

    function sendDataToSheet(eventData) {
      fetch(APPS_SCRIPT_URL, { method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify(eventData) })
        .then(()=> console.log('Data sent successfully'))
        .catch(err=> console.error('Error:', err));
    }

    let currentSeason = '';
    function showSeason(season) {
      currentSeason = season;
      document.querySelectorAll('.season-button').forEach(btn => btn.classList.toggle('active', btn.textContent.trim()=== (season==='spring'?'봄':season==='summer'?'여름':season==='autumn'?'가을':'겨울')));
      document.querySelectorAll('.recipe-thumbnails, .recipe-detail').forEach(el=> el.style.display='none');
      document.getElementById(season).style.display = 'block';
    }

    function showRecipe(id) {
      document.querySelectorAll('.recipe-detail').forEach(el=> el.style.display='none');
      if (currentSeason) document.getElementById(currentSeason).style.display='none';
      document.getElementById(id).style.display = 'block';
      sendDataToSheet({ type:'recipe_click', detail:id });
    }

    function backToThumbnails(season) {
      document.querySelectorAll('.recipe-detail').forEach(el=> el.style.display='none');
      document.getElementById(season).style.display = 'block';
      showSeason(season);
    }

    function loadComments() {
      const comments = JSON.parse(localStorage.getItem('comments')||'[]');
      const div = document.getElementById('commentsList');
      div.innerHTML='';
      comments.forEach(c => {
        const item = document.createElement('div');
        item.className='comment-item';
        item.innerHTML=`<span class="comment-rating">${'★'.repeat(c.rating)}</span><span>${c.text}</span>`;
        div.appendChild(item);
      });
    }

    function addComment(ev) {
      ev.preventDefault();
      const r = document.querySelector('input[name="rating"]:checked');
      const t = document.getElementById('commentInput').value.trim();
      if (!r || !t) return alert('별점과 내용을 모두 입력해주세요.');
      const rating = parseInt(r.value);
      const comments = JSON.parse(localStorage.getItem('comments')||'[]');
      comments.push({rating, text:t});
      localStorage.setItem('comments', JSON.stringify(comments));
      sendDataToSheet({ type:'comment', detail:`rating:${rating},comment:${t}`});
      document.getElementById('commentForm').reset();
      loadComments();
    }

    window.onload = ()=>{ loadComments(); showSeason('spring'); };
  </script>

</body>
</html>
