<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>초간단 비건 디저트 가이드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 2rem;
      background-color: #f9f9f9;
      color: #333;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }
    .season-buttons {
      margin-bottom: 1rem;
    }
    .season-button {
      margin-right: 0.5rem;
      padding: 0.3rem 0.8rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #fff;
      cursor: pointer;
    }
    .season-button.active {
      background-color: #dff5e1;
      color: #2c7a3f;
      font-weight: bold;
    }
    .thumbnail {
      margin-top: 1rem;
      cursor: pointer;
      font-weight: bold;
      border: 1px solid #ccc;
      padding: 0.5rem;
      background-color: #fff;
      width: fit-content;
    }
    .recipe-detail {
      margin-top: 1rem;
      padding: 1rem;
      border: 1px solid #ccc;
      background-color: #fff;
    }
    form {
      margin-top: 2rem;
      padding: 1rem;
      border: 1px solid #ccc;
      background-color: #fff;
    }
    textarea {
      width: 100%;
      height: 4rem;
      margin-top: 0.5rem;
    }
    .comment-rating {
      color: #f5b301;
      margin-right: 0.5rem;
    }
    .comment-item {
      margin: 0.5rem 0;
      display: flex;
      align-items: center;
    }
    #commentsList {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>초간단 비건 디저트 가이드</h1>
  <p>비건 디저트는 유제품과 달걀 없이도 가볍고 소화가 잘 되며, 알레르기나 식이 제한이 있는 사람들도 안심하고 즐길 수 있습니다...</p>

  <div class="season-buttons">
    <button class="season-button" onclick="showSeason('spring')">봄</button>
    <button class="season-button" onclick="showSeason('summer')">여름</button>
    <button class="season-button" onclick="showSeason('autumn')">가을</button>
    <button class="season-button" onclick="showSeason('winter')">겨울</button>
  </div>

  <div id="spring" class="recipe-thumbnails">
    <div class="thumbnail" onclick="showRecipe('matcha')">말차 라떼</div>
  </div>

  <div id="matcha" class="recipe-detail">
    <h2>말차 라떼</h2>
    <p>비건 말차 라떼 만드는 법.</p>
    <button onclick="backToThumbnails('spring')">목록으로</button>
  </div>

  <h3>발자국을 남겨주세요!</h3>
  <form id="commentForm" onsubmit="addComment(event)">
    <label><input type="radio" name="rating" value="1">★</label>
    <label><input type="radio" name="rating" value="2">★★</label>
    <label><input type="radio" name="rating" value="3">★★★</label>
    <label><input type="radio" name="rating" value="4">★★★★</label>
    <label><input type="radio" name="rating" value="5">★★★★★</label><br>
    <textarea id="commentInput" placeholder="내용 작성"></textarea><br>
    <button type="submit">전송</button>
  </form>
  <div id="commentsList"></div>

  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzBEFXoCmwB-TqUpZQ0Ar1Ezj8AsKgeClKKGVByhXcvbeQX1D2YFJbzJzFqGl5TTCWZKA/exec';

    function sendDataToSheet(eventData) {
      fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(eventData)
      })
      .then(() => console.log('Data sent successfully'))
      .catch(err => console.error('Error sending data:', err));
    }

    let currentSeason = '';
    let currentRecipe = '';

    function showSeason(season) {
      currentSeason = season;
      currentRecipe = '';

      document.querySelectorAll('.season-button').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.trim() === season);
      });

      document.querySelectorAll('.recipe-thumbnails, .recipe-detail').forEach(el => {
        el.style.display = 'none';
      });

      const seasonThumbs = document.getElementById(season);
      if (seasonThumbs) seasonThumbs.style.display = 'block';
    }

    function showRecipe(id) {
      currentRecipe = id;
      if (currentSeason) {
        const thumbs = document.getElementById(currentSeason);
        if (thumbs) thumbs.style.display = 'none';
      }

      document.querySelectorAll('.recipe-detail').forEach(el => el.style.display = 'none');
      const recipe = document.getElementById(id);
      if (recipe) {
        recipe.style.display = 'block';
        sendDataToSheet({ type: 'recipe_click', detail: id });
      }
    }

    function backToThumbnails(season) {
      currentRecipe = '';
      document.querySelectorAll('.recipe-detail').forEach(el => el.style.display = 'none');
      const thumbs = document.getElementById(season);
      if (thumbs) thumbs.style.display = 'block';
      showSeason(season);
    }

    function loadComments() {
      const comments = JSON.parse(localStorage.getItem('comments') || '[]');
      const commentsList = document.getElementById('commentsList');
      commentsList.innerHTML = '';
      comments.forEach(c => {
        const item = document.createElement('div');
        item.className = 'comment-item';
        item.innerHTML = `<span class="comment-rating">${'★'.repeat(c.rating)}${'☆'.repeat(5 - c.rating)}</span><span class="comment-text">${c.text}</span>`;
        commentsList.appendChild(item);
      });
    }

    function addComment(event) {
      event.preventDefault();
      const ratingInput = document.querySelector('input[name="rating"]:checked');
      const commentInput = document.getElementById('commentInput');
      const rating = ratingInput ? ratingInput.value : null;
      const commentText = commentInput.value.trim();

      if (!rating || !commentText) {
        alert('별점과 내용을 모두 입력해주세요.');
        return;
      }

      const comments = JSON.parse(localStorage.getItem('comments') || '[]');
      comments.push({ rating: parseInt(rating), text: commentText });
      localStorage.setItem('comments', JSON.stringify(comments));

      sendDataToSheet({ type: 'comment', detail: `rating: ${rating}, comment: ${commentText}` });

      document.getElementById('commentForm').reset();
      loadComments();
    }

    window.onload = () => {
  loadComments();
  showSeason('spring');
};
</script>
</body>
</html>
