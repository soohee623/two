<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>초간단 비건 디저트</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .recipe-thumbnails, .recipe-detail { display: none; margin-top: 20px; }
    .recipe-thumbnails img { width: 150px; cursor: pointer; margin: 10px; }
    .recipe-detail { border: 1px solid #ccc; padding: 10px; }
    .comment-item { margin-top: 10px; }
    .comment-rating { color: gold; margin-right: 10px; }
    .season-button.active { font-weight: bold; color: green; }
  </style>
</head>
<body>
  <h1>초간단 비건 디저트 가이드</h1>
  <p>비건 디저트는 유제품과 달걀 없이도 가볍고 소화가 잘 되며, 알레르기나 식이 제한이 있는 사람들도 안심하고 즐길 수 있습니다...</p>

  <div>
    <button class="season-button" onclick="showSeason('spring')">봄</button>
    <button class="season-button" onclick="showSeason('summer')">여름</button>
    <button class="season-button" onclick="showSeason('autumn')">가을</button>
    <button class="season-button" onclick="showSeason('winter')">겨울</button>
  </div>

  <!-- 예시 썸네일 -->
  <div id="spring" class="recipe-thumbnails">
    <img src="spring1.png" alt="말차" onclick="showRecipe('matcha')">
  </div>

  <div id="matcha" class="recipe-detail">
    <h2>말차 디저트</h2>
    <p>비건 말차 디저트입니다.</p>
    <button onclick="backToThumbnails('spring')">목록으로</button>
  </div>

  <h3>발자국을 남겨주세요!</h3>
  <form id="commentForm" onsubmit="addComment(event)">
    <div>
      <label><input type="radio" name="rating" value="1">★</label>
      <label><input type="radio" name="rating" value="2">★★</label>
      <label><input type="radio" name="rating" value="3">★★★</label>
      <label><input type="radio" name="rating" value="4">★★★★</label>
      <label><input type="radio" name="rating" value="5">★★★★★</label>
    </div>
    <textarea id="commentInput" placeholder="내용 작성"></textarea><br>
    <button type="submit">전송</button>
  </form>
  <div id="commentsList"></div>

  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxskVT8QqnES71g9h6R8A_kEQlXCYJGQIC6GJ5wGnHt98x0eBHhsb7BTUw3HOEVpE5A/exec';

    function sendDataToSheet(eventData) {
      fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(eventData)
      })
      .then(() => console.log('Data sent successfully'))
      .catch(err => console.error('Error sending data:', err));
    }

    let currentSeason = '';
    let currentRecipe = '';

    function showSeason(season) {
      currentSeason = season;
      currentRecipe = '';

      document.querySelectorAll('.season-button').forEach(btn => {
        const text = btn.textContent.trim();
        let seasonCode = text === '봄' ? 'spring' : text === '여름' ? 'summer' : text === '가을' ? 'autumn' : 'winter';
        btn.classList.toggle('active', seasonCode === season);
      });

      document.querySelectorAll('.recipe-thumbnails').forEach(el => el.style.display = 'none');
      const seasonThumbs = document.getElementById(season);
      if (seasonThumbs) seasonThumbs.style.display = 'flex';
    }

    function showRecipe(id) {
      currentRecipe = id;
      if (currentSeason) {
        const thumbs = document.getElementById(currentSeason);
        if (thumbs) thumbs.style.display = 'none';
      }
      document.querySelectorAll('.recipe-detail').forEach(el => el.style.display = 'none');
      const recipe = document.getElementById(id);
      if (recipe) {
        recipe.style.display = 'flex';
        sendDataToSheet({ type: 'recipe_click', detail: id });
      }
    }

    function backToThumbnails(season) {
      currentRecipe = '';
      const seasonThumbs = document.getElementById(season);
      if (seasonThumbs) seasonThumbs.style.display = 'flex';
      document.querySelectorAll('.recipe-detail').forEach(el => el.style.display = 'none');
      showSeason(season);
    }

    function loadComments() {
      const comments = JSON.parse(localStorage.getItem('comments') || '[]');
      const list = document.getElementById('commentsList');
      list.innerHTML = '';
      comments.forEach(c => {
        const item = document.createElement('div');
        item.className = 'comment-item';
        item.innerHTML = `<span class="comment-rating">${'★'.repeat(c.rating)}${'☆'.repeat(5 - c.rating)}</span> <span class="comment-text">${c.text}</span>`;
        list.appendChild(item);
      });
    }

    function addComment(event) {
      event.preventDefault();
      const form = document.getElementById('commentForm');
      const ratingInput = form.querySelector('input[name="rating"]:checked');
      const commentInput = document.getElementById('commentInput');
      const rating = ratingInput ? ratingInput.value : null;
      const commentText = commentInput.value.trim();

      if (!rating) return alert('별점을 선택해주세요.');
      if (!commentText) return alert('댓글 내용을 입력해주세요.');

      const comments = JSON.parse(localStorage.getItem('comments') || '[]');
      comments.push({ rating: parseInt(rating), text: commentText });
      localStorage.setItem('comments', JSON.stringify(comments));

      sendDataToSheet({
        type: 'comment',
        detail: `rating: ${rating}, comment: ${commentText}`
      });

      form.reset();
      commentInput.value = '';
      loadComments();
    }

    window.onload = () => {
      loadComments();
      showSeason('spring');
    };
  </script>
</body>
</html>
